<!DOCTYPE html>
<html>
<head>
    <title>Debug Environment Variables</title>
</head>
<body>
    <h1>Debug Environment Variables</h1>
    <button onclick="checkEnv()">Check Environment</button>
    <pre id="result" style="background: #f4f4f4; padding: 10px; white-space: pre-wrap;"></pre>

    <script type="module">
        window.checkEnv = function() {
            const result = document.getElementById('result');
            
            result.textContent = 'Environment Variables Check:\n\n';
            
            // Check if Vite env variables are available
            result.textContent += 'Environment Variables:\n';
            result.textContent += `VITE_SUPABASE_URL: ${import.meta.env.VITE_SUPABASE_URL || 'NOT SET'}\n`;
            result.textContent += `VITE_SUPABASE_ANON_KEY: ${import.meta.env.VITE_SUPABASE_ANON_KEY ? 'SET (hidden)' : 'NOT SET'}\n`;
            result.textContent += `VITE_DEV_MODE: ${import.meta.env.VITE_DEV_MODE || 'NOT SET'}\n`;
            result.textContent += `VITE_SITE_URL: ${import.meta.env.VITE_SITE_URL || 'NOT SET'}\n`;
            
            result.textContent += '\nAll Vite Environment Variables:\n';
            for (const [key, value] of Object.entries(import.meta.env)) {
                if (key.includes('SUPABASE')) {
                    result.textContent += `${key}: ${key.includes('KEY') ? 'SET (hidden)' : value}\n`;
                } else {
                    result.textContent += `${key}: ${value}\n`;
                }
            }
            
            // Try creating Supabase client
            result.textContent += '\nSupabase Client Test:\n';
            try {
                const { createClient } = await import('@supabase/supabase-js');
                
                const supabaseUrl = import.meta.env.VITE_SUPABASE_URL || '';
                const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY || '';
                
                if (!supabaseUrl || !supabaseAnonKey) {
                    result.textContent += '❌ Missing Supabase environment variables\n';
                    return;
                }
                
                const supabase = createClient(supabaseUrl, supabaseAnonKey, {
                    auth: {
                        autoRefreshToken: true,
                        persistSession: true,
                        detectSessionInUrl: true,
                        flowType: 'implicit'
                    }
                });
                
                result.textContent += '✅ Supabase client created successfully\n';
                
                // Check current session
                const { data: { session }, error } = await supabase.auth.getSession();
                
                if (error) {
                    result.textContent += `❌ Session error: ${error.message}\n`;
                } else if (session) {
                    result.textContent += `✅ Active session found for: ${session.user.email}\n`;
                    result.textContent += `Access token: ${session.access_token.substring(0, 20)}...\n`;
                    
                    // Check localStorage
                    const authKey = 'sb-uddmjjgnexdazfedrytt-auth-token';
                    const authData = localStorage.getItem(authKey);
                    if (authData) {
                        result.textContent += '✅ Auth data found in localStorage\n';
                    } else {
                        result.textContent += '❌ No auth data in localStorage\n';
                    }
                } else {
                    result.textContent += '❌ No active session found\n';
                }
                
            } catch (error) {
                result.textContent += `❌ Error creating Supabase client: ${error.message}\n`;
            }
        };
    </script>
</body>
</html>